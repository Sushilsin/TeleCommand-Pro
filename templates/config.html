{% extends "base.html" %}

{% block title %}Bot Configuration - TeleCommand Pro{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem;">‚öôÔ∏è Bot Configuration</h1>

<div class="card">
    <h2 class="card-title">Edit config.json</h2>
    
    <form method="POST">
        <div class="form-group">
            <label class="form-label" for="telegram_token">
                Telegram Bot Token
                <span style="color: #999; font-weight: normal;">(Get from @BotFather)</span>
            </label>
            <input type="text" class="form-control" id="telegram_token" name="telegram_token" 
                   value="{{ config.telegram_token }}" required 
                   placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz">
        </div>
        
        <div class="form-group">
            <label class="form-check">
                <input type="checkbox" name="whitelist_enabled" 
                       {% if config.whitelist_enabled %}checked{% endif %}>
                <span style="margin-left: 0.5rem;">
                    <strong>Enable Command Whitelist</strong>
                    <span style="display: block; font-size: 0.875rem; color: #666; margin-top: 0.25rem;">
                        When enabled, only commands listed below can be executed
                    </span>
                </span>
            </label>
        </div>
        
        <div class="form-group">
            <label class="form-label" for="allowed_commands">
                Allowed Commands
                <span style="color: #999; font-weight: normal;">(One per line, only if whitelist is enabled)</span>
            </label>
            <textarea class="form-control" id="allowed_commands" name="allowed_commands" 
                      placeholder="ls&#10;pwd&#10;df&#10;uptime&#10;ps"
                      style="font-family: 'Courier New', monospace;">{{ allowed_commands_str }}</textarea>
            <small style="color: #666; display: block; margin-top: 0.5rem;">
                Enter command names only (e.g., <code>ls</code>, <code>df</code>), not full paths
            </small>
        </div>
        
        <div class="form-group">
            <label class="form-label" for="command_timeout">
                Command Timeout (seconds)
            </label>
            <input type="number" class="form-control" id="command_timeout" name="command_timeout" 
                   value="{{ config.command_timeout }}" min="5" max="300" required>
            <small style="color: #666; display: block; margin-top: 0.5rem;">
                Maximum time a command can run before being terminated (5-300 seconds)
            </small>
        </div>
        
        <div style="display: flex; gap: 1rem;">
            {% if session.role == 'admin' %}
            <button type="submit" class="btn btn-primary">üíæ Save Configuration</button>
            {% else %}
            <button type="button" class="btn" style="background: #6b7280; color: white;" disabled>
                üîí Read-Only (Admin access required)
            </button>
            {% endif %}
            <a href="{{ url_for('index') }}" class="btn" style="background: #6c757d; color: white;">Cancel</a>
        </div>
    </form>
    
    <div style="margin-top: 2rem; padding: 1rem; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
        <strong>‚ö†Ô∏è Important:</strong>
        <ul style="margin: 0.5rem 0 0 1.5rem;">
            <li>User management (authorized_users) is done in the <a href="{{ url_for('users') }}">Users</a> page</li>
            <li>Changes take effect after restarting the bot</li>
            <li>Keep your bot token secure and never share it</li>
            <li>For security, enable whitelist in production</li>
        </ul>
    </div>
</div>

<div class="card">
    <h2 class="card-title">Current config.json</h2>
    <div class="code-block">{{ config | tojson(indent=2) }}</div>
    <p style="margin-top: 1rem; color: #666; font-size: 0.875rem;">
        <strong>üìÅ File location:</strong> <code>config.json</code> in the bot directory
    </p>
</div>

<div class="card">
    <h2 class="card-title">Quick Actions</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <h3 style="margin-bottom: 0.5rem; color: #667eea;">üîÑ Restart Bot</h3>
            <p style="font-size: 0.875rem; color: #666; margin-bottom: 1rem;">
                Stop and start the bot to apply configuration changes
            </p>
            <code style="font-size: 0.875rem;">
                # Stop bot (Ctrl+C)<br>
                # Then start again:<br>
                python3 bot.py
            </code>
        </div>
        
        <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <h3 style="margin-bottom: 0.5rem; color: #667eea;">üìä View Logs</h3>
            <p style="font-size: 0.875rem; color: #666; margin-bottom: 1rem;">
                Monitor bot activity in real-time
            </p>
            <code style="font-size: 0.875rem;">
                tail -f bot.log
            </code>
        </div>
        
        <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <h3 style="margin-bottom: 0.5rem; color: #667eea;">üîç Test Bot</h3>
            <p style="font-size: 0.875rem; color: #666; margin-bottom: 1rem;">
                Send a test message on Telegram
            </p>
            <code style="font-size: 0.875rem;">
                /start<br>
                /help
            </code>
        </div>
    </div>
</div>
{% endblock %}
